<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.faint.mapper.SearchMapper">


<!-- 검색창 검색 태그는 #, 닉네임은 @, 이름은 $ -->
<select id="listKeyword" resultType="java.lang.String">
<![CDATA[

select name from (

	select concat('#', t.name) as name, t.name as ordername
	from 	tbl_tag as t
	where	t.name like CONCAT('%',#{keyword},'%')
    
    union
    
    select concat('$', u.name) as name , u.name as ordername
	from 	tbl_user as u
	where	u.name like CONCAT('%',#{keyword},'%')

    union
    
    select concat('@', u.nickname) as name , u.nickname as ordername
	from 	tbl_user as u
	where	u.nickname like CONCAT('%',#{keyword},'%')
	
	union
	
	select concat('%', p.location) as name , p.location as ordername
	from 	tbl_post as p
	where	p.location like CONCAT('%',#{keyword},'%')
	
    ) as searchT
    order by left(ordername,char_length(#{keyword}))=#{keyword} desc, ordername asc
  
]]>
</select>

</mapper>